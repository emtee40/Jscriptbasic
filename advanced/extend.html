<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 | Generated by Apache Maven Doxia at Jan 17, 2013
 | Rendered using Apache Maven Fluido Skin 1.2.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>jScriptBasic - jScriptBasic Project Documentation</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido.min.js"></script>

    
      <meta name="author" content="Peter Verhas" />
    <meta name="Date-Creation-yyyymmdd" content="20121009" />
    <meta name="Date-Revision-yyyymmdd" content="20130117" />
    <meta http-equiv="Content-Language" content="en" />
    
        </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="http://scriptbasic.com" id="bannerLeft">
                                                                                                <img src="../"  alt="ScriptBasic for Java"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
            
                  <li id="publishDate">Last Published: 2013-01-17</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 1.0.4-SNAPSHOT</li>
                      
                
            
      
                                  
    <li class="pull-right">              <a href="http://scriptbasic.com" class="externalLink" title="ScriptBasic">ScriptBasic</a>
  </li>

                        </ul>
      </div>

            <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
            
                                    <h3>Documentation for SB4J</h3>
                  <ul>
                  <li class="none">
                          <a href="../intro.html" title="Introduction">Introduction</a>
            </li>
                  <li class="none">
                          <a href="../name.html" title="Name of the game">Name of the game</a>
            </li>
                  <li class="none">
                          <a href="../design.html" title="History and Design Goals">History and Design Goals</a>
            </li>
                  <li class="none">
                          <a href="../basic.html" title="Basic Language Implemented">Basic Language Implemented</a>
            </li>
                  <li class="none">
                          <a href="../install.html" title="Installation">Installation</a>
            </li>
                  <li class="none">
                          <a href="../advanced/index.html" title="Embedding API">Embedding API</a>
            </li>
                  <li class="none">
                          <a href="../configure.html" title="Configuration">Configuration</a>
            </li>
          </ul>
                        <h3>Project Documentation</h3>
                  <ul>
                                                                                                                                                                                                                                                        <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                      <li class="collapsed">
                          <a href="../project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                      
            
                
          <hr class="divider" />

           <div id="poweredBy">
                   
    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

    
    <div class="g-plusone" data-href="http://www.scriptbasic.com" data-size="tall" ></div>

                   <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
        <div id="bodyColumn"  class="span9" >
                                  
            <div class="section"><h2>How to extend ScriptBasic for Java with external Java Methods<a name="How_to_extend_ScriptBasic_for_Java_with_external_Java_Methods"></a></h2><p>ScriptBasic for Java can call Java methods from the BASIC source code. To do so the BASIC program should use the <tt>use</tt> and <tt>method</tt> commands. This way the BASIC source code expresses its wish to use some Java code. Doing it the other way around the embedding Java application can register some methods that will be available to the BASIC program without <tt>use</tt> or <tt>method</tt> declarations.</p><p>To register a method into the BASIC runtime and thus make it available for the BASIC program to call, ScriptBasic for Java provides a method <tt>registerExtension(Class&lt;?&gt; klass)</tt> in the <tt>EngineApi</tt> interface. Using this method the embedding application can register static methods from a class. The embedding application has to issue a single call and it will register all the methods that are appropriately annotated.</p><p>A method from a class is registered and becomes available for the BASIC program if it is annotated with the annotation <tt>com.scriptbasic.Function</tt> and if its classification is configured to allow the method to be used by the BASIC program.</p><p>For example we can have the following class in an application:</p><div class="source"><pre class="prettyprint">	public static class TestExtensionClass {
		@Function(alias = &quot;javaFunction&quot;, classification = java.lang.Long.class, requiredVersion = 1)
		public static Long fiftyFive() {
			return 55L;
		}
	}

</pre></div><p>This class contains a single <tt>static</tt> method that is very simple: it only returns a <tt>Long</tt> value: 55. This method is annotated with the annotation <tt>@Function</tt> that signals for the registering process that this method is a candidate for being called from BASIC.</p><p>The parameters for the annotation are all optional. The arguments are defined in the <a href="../apidocs/com/scriptbasic/Function.html">JavaDoc API</a>.</p><p>The declared function can be called after that from BASIC the following way:</p><div class="source"><pre class="prettyprint">		EngineApi engine = new Engine();
		engine.registerExtension(TestExtensionClass.class);
		engine.load(&quot;Sub aPie\nreturn javaFunction()\nEndSub\n&quot;);
		engine.execute();
		Long z = (Long) engine.getSubroutine(&quot;aPie&quot;).call();
		Assert.assertEquals((Long) 55L, z);
</pre></div><p>Note that extension methods should be <tt>static</tt>. If a non-static method is annotated in the registered class using the annotation <tt>@Function</tt> then the registering process will throw exception. The return value and the arguments can be any Java type. The interpreter will convert the BASIC value passed as actual parameter doing its best. Thus you can accept <tt>int</tt>, <tt>long&gt;&gt; and other primitive parameters, just as well as &lt;&lt;&lt;Integer</tt>, <tt>Long</tt> and so on. When a function returns some complex object the interpreter will use it without conversion and if it is stored in a variable then it is possible to pass the object to other Java methods that expect the type.</p><p>Because BASIC internally uses <tt>Long</tt> to store integer values, <tt>Double</tt> to store floating point values, <tt>Boolean</tt> to store boolean values, if you write a method that is specifically designed to be an extension function it is recommended that you use these classes instead of <tt>Integer</tt>, <tt>int</tt>, <tt>Float</tt>, <tt>float</tt>, <tt>double</tt> and so on.</p><p>Generally speaking you need not care about the internal data structures of ScriptBasic for Java when you write an extension method. The only exception is when you accept an array as an argument and when you return an array as an argument.</p><p>When the extension function handles an array as an argument the actual Java type should be compatible with <tt>BasicArrayValue</tt>. Simply saying: it can be <tt>BasicArrayValue</tt> or <tt>Object</tt>.</p><p>When you return an array it has to be <tt>BasicArrayValue</tt>. Note that the elements of the array need not be an object that implements <tt>RightValue</tt> as defined in the interpreter. It can be any Java object that will be converted by the interpreter when the array element is used in an expression in the BASIC program. This is different from returning a primitive value, which will be converted when the method returns. In this case the array in the BASIC program will contain Java objects and the conversion will happen only later when the value is used.</p><p>For more information on how to use the <tt>BasicArrayValue</tt> have a look at the <a href="../apidocs/com/scriptbasic/executors/rightvalues/BasicArrayValue.html">JavaDoc API</a>.</p><div class="section"><h3>alias<a name="alias"></a></h3><p>The <tt>alias</tt> of a method is the name of the BASIC function. In the example above the <tt>alias</tt> &quot;javaFunction&quot; is used and accordingly this name is used in the BASIC program. If the annotation parameter <tt>alias</tt> is not used then the actual name of the Java method will be used as the name of the function for the BASIC program.</p><p>Using <tt>alias</tt> can be handy in several cases. One case is when multiple methods have the same name. It is possible because Java does method overloading and different methods accepting different arguments may share the name. On the other hand in BASIC this is not possible. Using alias you can assign different names to the different argument versions of these methods.</p><p>Another use of the parameter <tt>alias</tt> is to define a BASIC friendly name to the method that is more appealing or more common for the BASIC programmers.</p></div><div class="section"><h3>requiredVersion<a name="requiredVersion"></a></h3><p><tt>requiredVersion</tt> is an integer value denoting the required version of the embedding interface of ScriptBasic. In the current version <tt>1.0.3</tt> of ScriptBasic for Java this is 1. The default version for this parameter is 1. This parameter is described in detail in the <a href="../apidocs/com/scriptbasic/Function.html">JavaDoc API</a>.</p><p>ScriptBasic version 1.0.4 adds functionality to the interface, thus the interface version number in this version is already 2.</p><p>For more information on the differences between the versions see the page <a href="./requiredVersion.html">versions</a>. </p></div><div class="section"><h3>substitueClass<a name="substitueClass"></a></h3><p>Using the annotations you can register methods that are in different classes. It can happen that the class you want to make usable by the BASIC program is defined in a package that you import into your project and you do not have the source code or simply you do not want to modify the source code inserting annotation to reserve maintenance ability. In such a case you can create a method in the class you register and you can annotate specifying the <tt>substituteClass</tt> and <tt>substituteMethod</tt>. If that case the actual name, parameters, return type of the method annotated is ignored and the class and method specified in the annotations are used instead.</p><p>You can see examples of the use of this annotation in the Scriptbasic for Java source code in the utility class <tt>com.scriptbasic.utility.RuntimeUtility</tt> where this annotation is used to declare some of the methods of the class <tt>java.lang.Math</tt> usable from BASIC. </p></div><div class="section"><h3>substitueMethod<a name="substitueMethod"></a></h3><p>Using this annotation you can specify an alternate method instead of the one annotated. In this case the actual name, parameters, return type of the method annotated is ignored and the one specified in the annotation is used. You can use this annotation along with <tt>substituteClass</tt> or without that. In the latter case you can give alternative names of the same method. The names, which are the names of the Java methods or are defined in the annotation <tt>alias</tt> are interchangeably used in the BASIC program.</p></div><div class="section"><h3>classification<a name="classification"></a></h3><p>Classification helps the security system of ScriptBasic for Java. You can classify a method into several groups. These classification groups classify the nature of the method and help the installation to decide if the invocation of a certain method is allowed or not. For example you can classify methods to be <tt>Constant</tt> when the method just returns a constant value. Actually this is how <tt>undef()</tt> is implemented. Other methods may be classified as <tt>Math</tt> to denote that they perform mathematical functions.</p><p>When an instance of ScriptBasic is running the interpreter reads the configuration file <tt>sb4j.properties</tt> as described in <a href="../configure.html">chapter configuration</a>. This configuration file may level the classifications as allowed and denied and based on that the ScriptBasic runtime can decide if a mathod is available for the BASIC program or not.</p><p>The classification groups are denoted by Java classes. However these classes have nothing to do with the actual classification. It is important to understand that the classes listed as classification do not play any special role. We could use strings just as well instead of java classes. The reason we decided to use java classes is to lessen the human errors that come from misspelling. Using Java classes you can have auto fill in your favorite IDE (e.g.: NetBeans or Eclipse) and you also get compilation error in case of misspelling. These IDEs also help you displaying the JavaDoc of the classes while you use them and JavaDoc is a good place to describe the details of the interfaces or classes that are used for classification.</p><p>It is recommended to create Java interfaces to be used as classification with names that express the actual classification group. It is not a must. You can use <tt>java.lang.Integer</tt> to classify a method, however it has drawbacks: seems to be meaningless and you have no easy way to document the meaning of the classification.</p></div></div>
                  </div>
            </div>
      
    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span16">Copyright &copy;                    2013
                        <a href="http://www.verhas.com">Verhas and Verhas Software Craftsmen</a>.
            All Rights Reserved.      
            
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
